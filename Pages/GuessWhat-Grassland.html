<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guess What | Grassland</title>
  <link rel="stylesheet" href="../responsive-fixes.css">
  <style>
    html,body{height:100%;margin:0;overflow:hidden}
    body{
      background: url('Images/Animal-10/Background.svg') center/cover no-repeat;
    }

    .app{
      width:100%;
      height:100%;
      position:relative;
    }

    .card{
      position:absolute;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      transition:transform .2s ease;
    }
    .card:hover{
        transform:scale(1.05);
        cursor:pointer}

    .silhouette img{
        width:100%;
        height:100%;
        object-fit:contain;
        transition:filter .3s ease, opacity .3s ease}
    .silhouette.sil img{
        filter:brightness(0) saturate(100%) contrast(120%);
        opacity:0.9;
    }
    .silhouette.revealed img{
        filter: drop-shadow(3px 3px 8px rgba(0,0,0,0.4));
        opacity:1;
    }

    /* UI */
    #closeBtn{
      position:absolute;
      top:1vh;
      right:2vw;
      font-size:clamp(20px, 4vw, 30px);
      background-color: rgb(187, 255, 119);
      cursor:pointer;
      border: none;
      border-radius: 0.5em;
      padding: 0.3em 0.6em;
      min-width: 2em;
      min-height: 2em;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Tombol sound 2D */
    #soundBtn{
      position:absolute;
      bottom:12px;
      left:12px;
      padding:0;
      border:none;
      background:none;
      cursor:pointer;
    }
    #soundBtn img{
      width:60px;
      height:60px;
      display:block;
    }

    #score{
      position:absolute;
      top:12px;
      left:50%;
      transform:translateX(-50%);
      font-size:24px;
      font-weight:bold;
      color:#000000;
      text-shadow:0 2px 6px rgba(0,0,0,0.5);
      background-color: rgb(187, 255, 119);
      padding: 0.8em 1.5em;
      border-radius: 1em;
    }

    #nextLevelBtn{
      display:none;
      position:absolute;
      top:15px;
      left:20px;
      padding:10px 16px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      background:#2b8ae2;
      color:#fff;
      font-size:20px;
      font-weight:bold;
    }
  </style>
</head>
<body>
  <div class="app" role="application">
    <button id="closeBtn" onclick="location.href='Mainmenu.html'">✖</button>
    <button id="soundBtn"><img src="Images/Sound.svg"></button>
    <div id="score">Score: 0 / 5</div>
    <button id="nextLevelBtn" onclick="location.href='GuessWhat-Ice.html'">Next Location ▶</button>
    <div id="grid"></div>
  </div>

  <!-- SFX -->
  <audio id="sfxCorrect" src="Audio/correct.mp3" preload="auto"></audio>
  <audio id="sfxWrong" src="Audio/wrong.mp3" preload="auto"></audio>
  <audio id="sfxScore" src="Audio/score.mp3" preload="auto"></audio>

  <script>
    // daftar hewan + audio clue
    const items = [
      {id:'Civet', file:'Images/Animal-10/Civet.svg', audio:'Audio/Animal-10/狸猫 (Li[35] Ba[5]).mp3', x:1200, y:150, size:100},
      {id:'Elephant', file:'Images/Animal-10/Elephant.svg', audio:'Audio/Animal-10/象 (chhīuⁿ).mp3', x:200, y:400, size:300},
      {id:'Firefly', file:'Images/Animal-10/Firefly.svg', audio:'Audio/Animal-10/螢火蟲 (hóe-kim-ko·).mp3', x:1400, y:400, size:50},
      {id:'Giraffe', file:'Images/Animal-10/Giraffe.svg', audio:'Audio/Animal-10/長頸鹿 (tn̂g-ām-lo̍k).mp3', x:900, y:200, size:200},
      {id:'Grasshopper', file:'Images/Animal-10/Grasshopper.svg', audio:'Audio/Animal-10/草蜢 Cau[52] Mi[2].mp3', x:1250, y:550, size:80},
      {id:'Turkey', file:'Images/Animal-10/Turkey.svg', audio:'Audio/Animal-10/火雞 (hóe-ke).mp3', x:600, y:385, size:150},
      {id:'Toad', file:'Images/Animal-10/Toad.svg', audio:'Audio/Animal-10/蛤蟆 (chiuⁿ-chû).mp3', x:80, y:420, size:50},
      {id:'Racoon', file:'Images/Animal-10/Racoon.svg', audio:'Audio/Animal-10/狸貓 (lî-bâ).mp3', x:100, y:150, size:100},
      {id:'Tiger', file:'Images/Animal-10/Tiger.svg', audio:'Audio/Animal-10/虎 (hó·).mp3', x:700, y:100, size:150},
      {id:'Zebra', file:'Images/Animal-10/Zebra.svg', audio:'Audio/Animal-10/斑馬 (pan-bé).mp3', x:500, y:200, size:100}
    ];

    let targetIndex = null;
    let correctCount = 0;
    const maxScore = 5;
    const audioCache = {};

    const grid = document.getElementById('grid');
    const scoreEl = document.getElementById('score');
    const soundBtn = document.getElementById('soundBtn');
    const nextLevelBtn = document.getElementById('nextLevelBtn');

    const sfxCorrect = document.getElementById('sfxCorrect');
    const sfxWrong = document.getElementById('sfxWrong');
    const sfxScore = document.getElementById('sfxScore');

    sfxCorrect.volume = 0.9;
    sfxWrong.volume = 0.9;
    sfxScore.volume = 1.0;

    // render cards + cache audio clue - with better responsive positioning
    function positionCard(el, item) {
      // Convert fixed pixels to responsive percentages with better bounds
      const baseWidth = 1366; // typical design width
      const baseHeight = 768; // typical design height

      // Calculate responsive percentages
      let leftPercent = (item.x / baseWidth) * 100;
      let topPercent = (item.y / baseHeight) * 100;

      // Calculate size as percentage of viewport (smaller for mobile)
      let sizePercent = Math.min((item.size / baseWidth) * 100, (item.size / baseHeight) * 100);

      // Mobile adjustments - keep everything within safe bounds
      if (window.innerWidth <= 768) {
        // Scale down positions for mobile to fit better
        leftPercent = Math.min(leftPercent * 0.85, 85); // Max 85% to leave margin
        topPercent = Math.min(topPercent * 0.8, 75); // Max 75% to leave margin for UI
        sizePercent = Math.max(sizePercent * 0.7, 6); // Minimum 6vw for touch targets
      }

      // Ensure nothing goes outside viewport bounds
      const finalWidth = Math.min(sizePercent, 20); // Max 20vw
      const finalHeight = Math.min(sizePercent, 20); // Max 20vh

      // Adjust position if element would overflow
      leftPercent = Math.min(leftPercent, 95 - (finalWidth * 0.5));
      topPercent = Math.min(topPercent, 90 - (finalHeight * 0.5));

      el.style.left = `${Math.max(leftPercent, 2)}vw`; // Min 2vw margin
      el.style.top = `${Math.max(topPercent, 10)}vh`; // Min 10vh margin for UI
      el.style.width = `${finalWidth}vw`;
      el.style.height = `${finalHeight}vh`;
    }

    items.forEach((item, i) => {
      const el = document.createElement('div');
      el.className = 'card';
      el.dataset.index = i;
      positionCard(el, item);

      const sil = document.createElement('div');
      sil.className = 'silhouette sil';
      const img = document.createElement('img');
      img.src = item.file; img.alt = item.id;
      sil.appendChild(img);
      el.appendChild(sil);

      el.addEventListener('click', onCardClick);
      grid.appendChild(el);

      const a = new Audio(item.audio);
      a.preload = 'auto';
      audioCache[item.id] = a;
    });

    function playAudioFor(i){
      if (i == null) return;
      const item = items[i];
      const aud = audioCache[item.id];
      if (!aud) return;
      aud.currentTime = 0;
      aud.play();
    }

    function pickRandomTarget(){
      const unrevealed = items.map((it,i)=>({it,i})).filter(x=>{
        const card = grid.querySelector(`[data-index='${x.i}']`);
        return card && !card.querySelector('.silhouette').classList.contains('revealed');
      });
      if (unrevealed.length === 0) return null;
      const pick = unrevealed[Math.floor(Math.random()*unrevealed.length)];
      targetIndex = pick.i;
      return targetIndex;
    }

    function startRound(){
      const t = pickRandomTarget();
      if (t == null) return;
      playAudioFor(t);
    }

    function onCardClick(e){
      const card = e.currentTarget;
      const i = Number(card.dataset.index);
      if (card.querySelector('.silhouette').classList.contains('revealed')) return;
      if (targetIndex === null) return;

      if (i === targetIndex){
        revealCard(card);
        sfxCorrect.currentTime = 0;
        sfxCorrect.play();
        correctCount++;
        scoreEl.textContent = `Score: ${correctCount} / ${maxScore}`;

        if (correctCount >= maxScore){
          nextLevelBtn.style.display = 'block';
          sfxScore.currentTime = 0;
          sfxScore.play();
          targetIndex = null;
        } else {
          targetIndex = null;
          setTimeout(startRound, 800);
        }
      } else {
        sfxWrong.currentTime = 0;
        sfxWrong.play();
        card.animate(
          [{transform:'translateX(0)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],
          {duration:400}
        );
      }
    }

    function revealCard(card){
      card.querySelector('.silhouette').classList.add('revealed');
    }

    soundBtn.addEventListener('click', ()=>{
      if (targetIndex == null){
        startRound();
      } else {
        playAudioFor(targetIndex);
      }
    });

    // Reposition cards on window resize for better responsiveness
    window.addEventListener('resize', () => {
      items.forEach((item, i) => {
        const el = grid.querySelector(`[data-index='${i}']`);
        if (el) positionCard(el, item);
      });
    });
  </script>
</body>
</html>
